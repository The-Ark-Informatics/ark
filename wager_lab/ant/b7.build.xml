<!-- ?xml version="1.0"? -->

<!--

    Target Biogenix Bluefire (v5) build script.
    
    PLEASE CHECK http://ant.apache.org/manual/index.html BEFORE ASKING FOR HELP
 
    $Id $
 -->


<project name="genix" default="deploy" basedir=".">
    <!-- Change this to build.properties -->
    <property name="buildpropertiesfile" value="b7.build.properties" />
    
    <property file="${buildpropertiesfile}" />    
    
        <path id="build.classpath">
        <pathelement location="${temp.classesdir}"/>
        <!--pathelement location="${temp.classesdir}-tmp"/-->
        
        <fileset dir="${appserver.libdir}">
            <include name="**/*.jar"/>
        </fileset>
        <fileset dir="${source.base}/pages/WEB-INF/lib">
            <include name="**/*.jar"/>
        </fileset>
        <fileset dir="${source.base}/pages/media/jh">
            <include name="**/*.jar"/>
        </fileset>
               
    </path>

    
    <!-- Compile all classes. -->
    <target name="compile" description="Compile all classes to a temp directory and copy stylesheets as well">
    
        <echo>*** Running Development Compilation for Biogenix ***</echo>
        <echo>Refer to http://ant.apache.org/manual/index.html if you require assistance with this script</echo>
        <echo message="" />
    	
        <echo>Creating temp output directories</echo>
        <mkdir dir="${temp.base}" />
        <mkdir dir="${temp.sourcedir}" />
        <mkdir dir="${temp.classesdir}"/>
        <mkdir dir="${temp.classesdir}/pages/media/neuragenix/bio/help"/>
        
        
    	<!--copy src (base then overwrite with client-->
        <echo>Copying core code to temp folder</echo>
        <copy todir="${temp.sourcedir}">
           <fileset dir="${source.srcdir}" includes="**/*"/>
        </copy>        
        <echo>Copying Client Customisation Code to temp folder- if any</echo>
        <copy todir="${temp.sourcedir}" failonerror="false" overwrite="true">
            <fileset dir="${source.client.srcdir}" includes="**/*"/>
        </copy>
    	
    	<!--compile-->
        <echo>Compiling source code in temp folder</echo>
        <javac srcdir="${temp.sourcedir}"  destdir="${temp.classesdir}" classpathref="build.classpath" debug="true" />


         <!-- copy the stylesheets to temp folder (core first then overwrite with client customization -->
        <echo>Copying xml stylesheets to temp folder (core stylesheets then client customization on top)</echo>
        <copy todir="${temp.classesdir}">
            <fileset dir="${source.stylesheetdir}" includes="**/*"/>
        </copy>
    	<echo>Copying client customisation stylesheets to temp folder - if any</echo>
        <copy todir="${temp.classesdir}" failonerror="false" overwrite="true">
            <fileset dir="${source.client.stylesheetdir}" includes="**/*"/>
        </copy>   
    	
    </target>
    
    
    
        
    <!-- Create Javadocs. -->
    <target name="javadocs" depends="compile" description="generate javadocs">
        <delete dir="${temp.docdir}"/>
        <mkdir dir="${temp.docdir}"/>
        <javadoc packagenames="neuragenix.*"
            sourcepath="${source.srcdir}"
            destdir="${temp.docdir}"
            author="true"
            version="true"
            use="true"
            windowtitle="Biogenix Platform Documentation"
            doctitle="Biogenix Platform API"
            bottom="Copyright (C) 2006 xBioSystems Pty. Ltd."/>
    </target>
    
    
    <!-- Copy to destination -->
    <target name="deploy" depends="compile" >
    
        <mkdir dir="${deploy.home}"/>
        <mkdir dir="${deploy.libdir}"/>
        <mkdir dir="${deploy.classesdir}"/>
        <mkdir dir="${deploy.classesdir}/properties"/>
        <!-- todo: delete the deploy base folder? or maybe new target to do that, maybe just to copy files other than code -->
        <!-- <buildnumber/> -->            
        
        <copy todir="${deploy.home}">
            <fileset dir="${source.pagesdir}"/>
        </copy>
    	
        <copy todir="${deploy.home}" failonerror="false" overwrite="true">
            <fileset dir="${source.client.pagesdir}"/>
        </copy>        
    	
        <copy todir="${deploy.classesdir}">
            <fileset dir="${temp.classesdir}"/>
        </copy>        
        
        <copy todir="${deploy.classesdir}" overwrite="true">
            <fileset dir="${source.propertiesdir}"/>
        </copy>

    </target>

    <target name="update-deployed-properties" description="Updates deployed portal properties">
        <propertyfile file="${deploy.classesdir}/properties/portal.properties" comment="Portal Properties">
          <!--   <entry key="neuragenix.hub.businessRuleSchema" value="${deploy.home}/pages/RuleHandlerSchema.xml"/>    -->
            
            <entry key="neuragenix.bio.patient.SaveConsentLocation" value="${deploy.home}/files/consent_files/"/>
            <entry key="neuragenix.bio.microarray.AttachmentLocation" value="${deploy.home}/files/microarray_files/"/>            
            <entry key="neuragenix.bio.survey.SaveSurveyLocation" value="${deploy.home}/files/survey_files/"/>   
            <entry key="neuragenix.bio.integration.ImportFileLocation" value="${deploy.home}/files/import_files/"/>
            <entry key="neuragenix.bio.search.ExportFileLocation" value="${deploy.home}/files/export_files/"/>
            <entry key="neuragenix.genix.report.OLAPSchemaLocation" value="${deploy.home}/WEB-INF/queries/"/>
            <entry key="neuragenix.genix.report.ReportLocation" value="${deploy.home}/files/report_files/"/>
            <entry key="neuragenix.genix.orgchart.PictureLocation" value="${deploy.home}/files/picture_files/"/>
            <entry key="neuragenix.genix.templates.TemplateLocation" value="${deploy.home}/files/templates/"/>
            <entry key="neuragenix.genix.templates.StoreDocumentLocation" value="${deploy.home}/files/store_document/"/>
            <!--entry key="neuragenix.genix.workflow.SaveWorkflowXPDLLocation" value="${deploy.home}/files/workflow_XPDL_files/"/-->
            <entry key="neuragenix.riskcentre.SavePDFLocation" value="${deploy.home}/bio45/files/diary_notes/"/> 
            <entry key="neuragenix.genix.smartform.AttachmentLocation" value="${deploy.home}/files/smartform_attach_files/"/>
            <entry key="neuragenix.bio.patient.SaveAttachmentsLocation" value="${deploy.home}/files/smartform_attach_files/"/>
            <entry key="neuragenix.bio.patient.SaveAnalysisLocation" value="${deploy.home}/files/"/>
            <entry key="neuragenix.bio.patient.SaveNotesLocation" value="${deploy.home}/files/"/>
            <entry key="solution.type" value="Biogenix"/>
            <entry key="neuragenix.dao.DBMSType" value="${dbms.type}"/>
            <entry key="neuragenix.hub.batchloader.BundleFileLocation" value="${deploy.home}/files/"/>
        </propertyfile>

        <property file="${deploy.classesdir}/properties/portal.properties" />
        
        <mkdir dir="${neuragenix.bio.patient.SaveConsentLocation}"/>
        <mkdir dir="${neuragenix.bio.microarray.AttachmentLocation}" />
        <mkdir dir="${neuragenix.bio.survey.SaveSurveyLocation}" />
        <mkdir dir="${neuragenix.bio.integration.ImportFileLocation}" />
        <mkdir dir="${neuragenix.bio.search.ExportFileLocation}" />
        <mkdir dir="${neuragenix.genix.report.OLAPSchemaLocation}" />
        <mkdir dir="${neuragenix.genix.report.ReportLocation}" />
        <mkdir dir="${neuragenix.genix.orgchart.PictureLocation}" />
        <mkdir dir="${neuragenix.genix.templates.TemplateLocation}" />
        <mkdir dir="${neuragenix.genix.templates.StoreDocumentLocation}" />
        <!--mkdir dir="${neuragenix.genix.workflow.SaveWorkflowXPDLLocation}" /-->
        <!--mkdir dir="${neuragenix.riskcentre.SavePDFLocation}" /--> 
        <mkdir dir="${neuragenix.genix.smartform.AttachmentLocation}" />
        <mkdir dir="${neuragenix.bio.patient.SaveAttachmentsLocation}" />
        <mkdir dir="${neuragenix.bio.patient.SaveAnalysisLocation}" />
        <mkdir dir="${neuragenix.bio.patient.SaveNotesLocation}" />
        <mkdir dir="${neuragenix.hub.batchloader.BundleFileLocation}" /> 
    </target>
    
    
            
    <target name="touch" description="Reset file to current time">
        <touch>
            <fileset dir="${source.base}" includes="**/*"/>
        </touch>       
    </target>



    <target name="clean"
        description="Delete old build (temp directories) ">
        <delete dir="${temp.classesdir}"/>
        <!--delete dir="${build.classesdir}-tmp"/-->
    
        <delete dir="${temp.base}" />
        <delete dir="${temp.sourcedir}" />
    </target>
    
    <target name="full-clean"
        description="Clean old build code (temp directories) and the deployment folder (tomcat web app)">
        <delete dir="${temp.classesdir}"/>
        <!--delete dir="${build.classesdir}-tmp"/-->   
        <delete dir="${temp.sourcedir}" />        
        <delete dir="${temp.base}" />

        
        <delete dir="${deploy.classesdir}/properties" failonerror="false" />
        <delete dir="${deploy.classesdir}" failonerror="false" />
        <delete dir="${deploy.libdir}" failonerror="false" />
        <delete dir="${deploy.home}" failonerror="false" />
    </target>
    

</project>


